<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="color-scheme" content="dark light"><title>ASP.NET 5 CI from Git to Azure without Visual Studio</title><meta name="description" content="Using Visual Studio Online Build Services"><meta name="author" content="Devon Burriss"><meta itemprop="name" content="ASP.NET 5 CI from Git to Azure without Visual Studio"><meta itemprop="description" content="Using Visual Studio Online Build Services"><meta itemprop="image" content="https://devonburriss.me/img/explore-590.jpg"><link rel="canonical" href="https://devonburriss.me/aspnet-vsonline-ci/"><meta itemprop="datePublished" content="2015-09-10" id="date"><meta itemprop="dateModified" content="2015-09-10" id="mdate"><meta itemprop="headline" content="ASP.NET 5 CI from Git to Azure without Visual Studio - Using Visual Studio Online Build Services"><meta itemprop="mainEntityOfPage" content="https://devonburriss.me/aspnet-vsonline-ci/"><meta name="headline" content="ASP.NET 5 CI from Git to Azure without Visual Studio - Using Visual Studio Online Build Services"><link rel="icon" type="image/png" href="/img/favicon16.png" sizes="16x16"><link rel="icon" type="image/png" href="/img/favicon32.png" sizes="32x32"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@DevonBurriss"><meta name="twitter:title" content="ASP.NET 5 CI from Git to Azure without Visual Studio"><meta name="twitter:description" content="Using Visual Studio Online Build Services"><meta name="twitter:creator" content="@DevonBurriss"><meta name="twitter:image" content="https://devonburriss.me/img/explore-590.jpg"><meta property="og:title" content="ASP.NET 5 CI from Git to Azure without Visual Studio"><meta property="og:type" content="article"><meta property="og:url" content="https://devonburriss.me/aspnet-vsonline-ci/"><meta property="og:image" content="https://devonburriss.me/img/explore-590.jpg"><meta property="og:description" content="Using Visual Studio Online Build Services"><meta property="og:site_name" content="Devon Burriss&#39; Blog"><link rel="stylesheet" href="/css/site.css"><link rel="stylesheet" href="/css/highlight/atom-one-dark.css"><script>(function(){try{var t=localStorage.getItem('theme');if(t==='dark'||t==='light'){document.documentElement.dataset.theme=t;}}catch(e){}})();</script><script src="/js/theme.js" defer="defer"></script></head><body><header class="site-header"><nav class="site-nav"><ul class="site-links"><li><a href="/">Home</a></li><li><a href="/topics/">Topics</a></li><li><a href="/recommended-reading.html">Reading</a></li><li><a href="/about/">About</a></li><li><a href="/rss.xml">RSS</a></li></ul><button type="button" class="theme-toggle" id="theme-toggle" aria-label="Toggle light/dark theme">Theme</button></nav></header><main class="site-main"><span style="display:contents"><header class="page-header"><h1>ASP.NET 5 CI from Git to Azure without Visual Studio</h1><p class="page-subtitle">Using Visual Studio Online Build Services</p><p class="post-meta">Devon Burriss &#183; Sep 10, 2015</p></header><div class="topic-pills"><a class="topic-pill" href="/topics/tooling-automation/" title="Build tooling, CI/CD, editors, and developer automation.">Tooling &amp; Automation</a></div><hr></span><article class="prose"><blockquote>
<p>Using Visual Studio Online Build Services for a MSBuild/xproj free deployment.</p>
</blockquote>
<p>So my laptop was in for repairs so I decided to dust off my old Macbook Pro. I upgraded to Yosemite, downloaded <a href="https://code.visualstudio.com/">VSCode</a> and ran through the the <a href="http://docs.asp.net/en/latest/getting-started/installing-on-mac.html">setup for DNX</a> on Mac. Very quickly I started to wonder about deploying to <a href="http://azure.microsoft.com/en-us/get-started/">Azure</a>.</p>
<!--more-->
<p>I had previously used the steps described <a href="https://msdn.microsoft.com/Library/vs/alm/Build/azure/deploy-aspnet5">here</a> to deploy a Visual Studio 2015 ASP.NET 5 project from Git but that relied on an xproj file for publishing.</p>
<p>The other option is publishing to Azure via source control as described <a href="https://azure.microsoft.com/en-us/documentation/articles/web-sites-publish-source-control/">here</a>.</p>
<p>I wanted something similar to the 1st option but for a solution created in VSCode and the aspnet <a href="http://yeoman.io/">Yeoman</a> <a href="https://www.npmjs.com/package/generator-aspnet">generator</a> though so what follows is what I have come up with so far.</p>
<p><em>NOTE: The project structure could use some work but the scripts work.</em></p>
<p><img src="/img/posts/2015/guy-on-mac_800.jpg" alt="guy on mac" /></p>
<h3 id="step-1-project-setup">Step 1: Project Setup</h3>
<p>The publish script uses the <code>global.json</code> file to determine the version and runtime. In the root is also <code>Publish.ps1</code> and <code>Upload.ps1</code> powershell scripts.
<a href="https://github.com/dburriss/vsfree-azure-deploy/tree/master/example">Example</a></p>
<h4 id="global">Global</h4>
<script src="https://gist.github.com/dburriss/155c693de8f534bd1536.js"></script>
<p>Setup the <code>global.json</code> file with properties needed for the publish.</p>
<h4 id="publish-script">Publish script</h4>
<script src="https://gist.github.com/dburriss/ea01dad652e00b480a7a.js"></script>
<p>This script does a couple things along the way to publishing a folder for deployment.</p>
<ol>
<li>Bootstraps DNVM into the Powershell session</li>
<li>Installs DNX on the build host</li>
<li>Restores the packages for the project using <code>dnu restore</code></li>
<li>Packages the project using <code>dnu package</code></li>
<li>Copies the runtime foler into the package (I think dnu restore is supposed to do this but at time of writing it was not)</li>
<li>Sets the <strong>web.config</strong> DNX version and runtime</li>
</ol>
<h4 id="upload-script">Upload Script</h4>
<p>This is a script found here <a href="https://gist.github.com/davideicardi/a8247230515177901e57">davideicardi/kuduSiteUpload.ps1 </a> which worked like a charm.
<strong>UPDATE:</strong> <em>I changed this script to stop the website before upload and start it again after as deployment was failing regularly with a 500 server error. My guess is locked files.</em></p>
<script src="https://gist.github.com/dburriss/af2e1593543b36b1ee23.js"></script>
<h4 id="vsonline-build-setup">VSOnline Build Setup</h4>
<h5 id="step-1-publish">Step 1: Publish</h5>
<p><img src="/img/posts/2015/Build1.png" alt="Build step 1 - Publish" />
Firstly we add a PowerShell script and point the script at our publish script:</p>
<ul>
<li>Script fielname: site/Publish.ps1</li>
<li>Arguments: -sourceDir $(Build.SourcesDirectory)\pub</li>
</ul>
<h5 id="step-2-upload">Step 2: Upload</h5>
<p><img src="/img/posts/2015/Build2.png" alt="Build step 1 - Upload" />
Next we setup the upload script by creating an <strong>Azure PowerShell</strong> script:</p>
<ul>
<li>Azure Subscription: If you do not have one setup click Manage to do so</li>
<li>Script Path: site/Upload.ps1</li>
<li>Arguments: -websiteName <em>MyWebSite</em> -sourceDir $(Build.SourcesDirectory)\pub -destinationPath /site</li>
</ul>
<p>Where <em>MyWebSite</em> is the name of the website in Azure.</p>
<p>Hit <strong>Save</strong> to save the build configuration.</p>
<h4 id="step-3-setup-ci-optional">Step 3: Setup CI (optional)</h4>
<p>If you want CI you can go to the <strong>Triggers</strong> tab and set a build to trigger on commit to a branch.</p>
<ul>
<li>Select <strong>CI</strong>.</li>
<li>Select <strong>Batch changes</strong></li>
<li>I filtered on <strong>master</strong> branch. Choose whatever is applicable.</li>
</ul>
<p>Hit the <strong>Save</strong> button.</p>
<h4 id="step-4-test-your-build">Step 4: Test your Build</h4>
<p>Now you can either hit <strong>Queue build...</strong> or if you setup CI do a push to the trigger enabled branch. Note that the triggered build can sometimes take a few minutes to be queued and takes almost 5 minutes to build and deploy even for a small test site.</p>
<h3 id="conclusion">Conclusion</h3>
<p>Thats it for deploying to Azure with a solution developed on OSX (or Linux). Just 2 scripts really.
I hope this helps someone and please leave a comment below if you have any questions or suggestions. Or just want to say it helped :)</p>
</article><hr><nav class="pager"><ul class="pager-links"><li><a href="/installing-docker-on-hyper-v/" title="Installing Docker on Hyper-V">← Previous</a></li><li><a href="/asp-net-5-tips-tempdata/" title="ASP.NET 5 Tips: TempData">Next →</a></li></ul></nav></main><footer class="site-footer"><p>Copyright &#169; <a href="/about/">Devon Burriss</a> 2026</p></footer><div class="comments"><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'devonburriss';(function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = 'https://devonburriss.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div><script src="/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-45750611-2', 'auto');ga('send', 'pageview');</script></body></html>