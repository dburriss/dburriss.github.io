<!DOCTYPE html>
<html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="color-scheme" content="dark light"><title>The Page Module Model with F# and Canopy</title><meta name="description" content="Using F#, Canopy (Selenium) and the Page Object(Module) Model to test UIs in a way that makes tests readable and easy to maintain"><meta name="author" content="Devon Burriss"><meta itemprop="name" content="The Page Module Model with F# and Canopy"><meta itemprop="description" content="Using F#, Canopy (Selenium) and the Page Object(Module) Model to test UIs in a way that makes tests readable and easy to maintain"><meta itemprop="image" content="https://devonburriss.me/img/posts/2018/frame-500.jpg"><link rel="canonical" href="https://devonburriss.me/page-module-model/"><meta itemprop="datePublished" content="2018-08-12" id="date"><meta itemprop="dateModified" content="2018-08-12" id="mdate"><meta itemprop="headline" content="The Page Module Model with F# and Canopy - Its like testing with the Page Object Model but way way cooler"><meta itemprop="mainEntityOfPage" content="https://devonburriss.me/page-module-model/"><meta name="headline" content="The Page Module Model with F# and Canopy - Its like testing with the Page Object Model but way way cooler"><link rel="icon" type="image/png" href="/img/favicon16.png" sizes="16x16"><link rel="icon" type="image/png" href="/img/favicon32.png" sizes="32x32"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@DevonBurriss"><meta name="twitter:title" content="The Page Module Model with F# and Canopy"><meta name="twitter:description" content="Using F#, Canopy (Selenium) and the Page Object(Module) Model to test UIs in a way that makes tests readable and easy to maintain"><meta name="twitter:creator" content="@DevonBurriss"><meta name="twitter:image" content="https://devonburriss.me/img/posts/2018/frame-500.jpg"><meta property="og:title" content="The Page Module Model with F# and Canopy"><meta property="og:type" content="article"><meta property="og:url" content="https://devonburriss.me/page-module-model/"><meta property="og:image" content="https://devonburriss.me/img/posts/2018/frame-500.jpg"><meta property="og:description" content="Using F#, Canopy (Selenium) and the Page Object(Module) Model to test UIs in a way that makes tests readable and easy to maintain"><meta property="og:site_name" content="Devon Burriss&#39; Blog"><link rel="stylesheet" href="/css/site.css"><link rel="stylesheet" href="/css/highlight/atom-one-dark.css"><script>(function(){try{var t=localStorage.getItem('theme');if(t==='dark'||t==='light'){document.documentElement.dataset.theme=t;}}catch(e){}})();</script><script src="/js/theme.js" defer="defer"></script><script type="module" src="/js/search-ui.js"></script></head><body><header class="site-header"><nav class="site-nav"><a class="site-title nav-badge" href="/">DEVON BURRISS</a><ul class="site-links"><li><a href="/">Home</a></li><li><a href="/topics/">Topics</a></li><li><a href="/notes/">Notes</a></li><li><a href="/recommended-reading.html">Reading</a></li><li><a href="/about/">About</a></li><li><a href="/rss.xml">RSS</a></li></ul><button type="button" class="theme-toggle" id="theme-toggle" aria-label="Toggle light/dark theme">Theme</button></nav></header><main class="site-main"><span style="display:contents"><header class="page-header"><h1>The Page Module Model with F# and Canopy</h1><p class="page-subtitle">Its like testing with the Page Object Model but way way cooler</p><p class="post-meta">Devon Burriss &#183; Aug 12, 2018</p></header><div class="topic-pills"><a class="topic-pill" href="/topics/engineering-practices/" title="How we build, test, and validate software.">Engineering Practices</a><a class="topic-pill" href="/topics/platforms-runtime/" title="Runtimes and execution environments (not frameworks).">Platforms &amp; Runtime</a></div><hr></span><article class="prose"><p>In the past I have done some UI testing with Selenium. I quickly adopted the Page Object Model (POM) for this kind of testing to ease readability, maintenance, and re-use across tests. Recently I needed to look into doing some UI testing and I decided to use <a href="https://lefthandedgoat.github.io/canopy/">Canopy</a> to abstract away working with Selenium. Although Canopy has some great helpers around Selenium I still found myself wanting to abstract away elements on each page and the pages themselves. Enter the Page Module Model (PMM)&hellip;</p>
<!--more-->
<p>So full disclosure&hellip; I doubt PMM is a thing. I didn't even try search for it until writing the previous sentence. It isn't. Yet&hellip; It is similar to the POM except using <code>module</code>s because I am using F#.</p>
<h2 id="what-is-the-page-object-model">What is the page object model?</h2>
<p>The POM is simple. We encapsulate interactions with pages and elements on the site with objects. Here is an example of an <a href="https://github.com/dburriss/UiMatic">old POM framework I wrote years ago</a>.</p>
<pre><code class="language-csharp">[Url(key: &quot;home&quot;)]
public class GoogleHomePage : Page
{
    [Selector(name: &quot;q&quot;)]
    public IInput SearchBox { get; set; }

    public GoogleHomePage(IDriver driver) : base(driver)
    {}
}
</code></pre>
<p>We can then use this class to instantiate an object that we interact with instead of interacting with Selenium directly.</p>
<pre><code class="language-csharp">[Theory]
[InlineData(TestTarget.Chrome)]
public void Title_OnGoogleHomePageUsingConfig_IsGoogle(TestTarget target)
{
    using (IDriver driver = GetDriver(target, config))
    {
        //create page model for test
        var homePage = Page.Create&lt;GoogleHomePage&gt;(driver);
        //tell browser to navigate to it
        homePage.Go&lt;GoogleHomePage&gt;();
        //fill a value into the text box
        homePage.SearchBox.Value = &quot;TEST&quot;;
        //an example of interacting with the config if needed. This gets expected title from config. 
        var expectedTitle = config.GetPageSetting(&quot;home&quot;).Title;
        //check the titles match
        Assert.Equal(expectedTitle, homePage.Title);
    }
}
</code></pre>
<p>If you have ever written tests against Selenium directly I am sure you can agree that is cleaner.</p>
<h2 id="writing-tests-in-f-and-canopy-with-page-module-model">Writing tests in F# and Canopy with Page Module Model</h2>
<blockquote>
<p>You can find the <a href="https://github.com/dburriss/PageModuleModelExample">source code for this example on Github</a></p>
</blockquote>
<p>So what would the Page Object Model look like with static functions on a <code>module</code>? Pretty cool actually&hellip;</p>
<pre><code class="language-fsharp">&quot;No laptops are free&quot; &amp;&amp;&amp; fun _ -&gt;
    HomePage.searchFor &quot;Laptops&quot;
    let results = SearchResultsPage.results()
    test &lt;@ results |&gt; List.forall (fun x -&gt; x.Price &gt; 0m) @&gt;
</code></pre>
<p>We can keep the tests really concise and describe what we want to happen. Here we search for &ldquo;Laptops&rdquo;, get the search results, and then check that the price is not 0 on any items. We will dive a little deeper into how this is done in the next section.</p>
<p>This style also allows us to easily define simple smoke tests to run before getting into the the more functional tests. A smoke test is an easy quick test of something basic. The idea being that <em>&ldquo;Where there is smoke there is fire&rdquo;</em>, so if a smoke test fails, it is not worth proceeding with the more feature rich tests.</p>
<pre><code class="language-fsharp">context &quot;Smoke tests&quot;
skipAllTestsOnFailure &lt;- true
&quot;home page loads&quot; &amp;&amp;&amp; fun _ -&gt; displayed HomePage.homePageBanner
&quot;search box available&quot; &amp;&amp;&amp; fun _ -&gt; displayed Header.searchBox
&quot;cart is available&quot; &amp;&amp;&amp; fun _ -&gt; displayed Header.basketButton
</code></pre>
<p>We use the <code>skipAllTestsOnFailure &lt;- true</code> to make sure we skip any other tests if any smoke tests fails.</p>
<h2 id="the-building-blocks-for-composition">The building blocks for composition</h2>
<p>I usually build a page that I need and then start extracting the reusable functions out into modules from there. Most sites will have some kind of header/navigation. Here is what I needed in a header for the tests I wrote for this post.</p>
<pre><code class="language-fsharp">module Header =
    //selectors
    let searchBox = &quot;#search_query&quot;
    let basketButton = &quot;a[href=\&quot;/winkelmandje\&quot;]&quot;

    //actions
    let searchFor term =
        searchBox &lt;&lt; term
        press enter
</code></pre>
<p>Here we define some selectors and a simple function that allows us to use the search functionality.</p>
<p>If possible to modify the HTML I recommend putting <code>data-test-xyz</code> style attributes on your elements to allow you to easily query elements. Unfortunately I did not have the luxury to do so even if the front-end developers would let a back-end developer like me near it. Probably wise üòÉ</p>
<p>Let's look at something a bit more complex. The following module represents search results on a page.</p>
<pre><code class="language-fsharp">module SearchResults =
    open OpenQA.Selenium

    type SearchResultElement = {
        ProductId:string
        El:IWebElement
        Name:string
        Price:decimal
        IsAvailable:bool
    }

    let private toPrice (s:string) = s.Split(&quot;,&quot;).[0] |&gt; decimal
    let private getOrderButton itemEl = itemEl |&gt; elementWithin @&quot;.product__order-button&quot;
    let private isOrderButton (orderBtnEl:IWebElement) =
        orderBtnEl
        |&gt; getAttrValue &quot;class&quot;
        |&gt; fun s -&gt; s.Split(&quot; &quot;)
        |&gt; Array.contains @&quot;action--order&quot;

    let items () =
        let rowEls = element (sData &quot;component&quot; &quot;products&quot;)
                    |&gt; elementsWithin &quot;.card&quot;
        let getId itemEl = itemEl |&gt; elementWithin &quot;a&quot; |&gt; getDataAttrValue &quot;productid&quot;
        let getTitle itemEl = itemEl |&gt; elementWithin &quot;a&quot; |&gt; getAttrValue &quot;title&quot;
        let getPrice itemEl = itemEl |&gt; elementWithin @&quot;.product__sales-price&quot; |&gt; read |&gt; toPrice

        rowEls
        |&gt; List.map (fun itemEl -&gt;
                                {
                                    ProductId = itemEl |&gt; getId
                                    El = itemEl
                                    Name = itemEl |&gt; getTitle
                                    Price = itemEl |&gt; getPrice
                                    IsAvailable = itemEl |&gt; getOrderButton |&gt; isOrderButton
                                })
</code></pre>
<p>This is a bit complex because of the poor selector options available to me in the HTML but still not too bad. I want to draw attention to the <code>SearchResultElement</code> record. I parse the HTML to a record rather than constantly interacting with <code>IWebElement</code>. You saw this in the test for a 0 price where I was able to easily check the <code>Price</code> field.</p>
<p>Note: I make use of some helpers here like <code>getDataAttrValue</code> that are in the <code>Selectors.fs module</code> which you can checkout in the source if you like.</p>
<h2 id="the-page-module">The Page Module</h2>
<p>With these building blocks the actual page <code>module</code> can end up being quite simple.</p>
<pre><code class="language-fsharp">module SearchResultsPage =
    open Elements
    open canopy.classic

    let uri = &quot;https://www.coolblue.nl/zoeken&quot; //should use settings or relative urls
    let verifyOn() = on uri
    let searchFor term = Header.searchFor term
    let results() = SearchResults.items()
</code></pre>
<p>With the page we can now group functionality on a module that makes semantic sense and compose our functions from the building blocks we have already defined.</p>
<h2 id="summary">Summary</h2>
<p><img src="/img/posts/2018/ui-testing.jpg" alt="UI testing with Canopy" /></p>
<p>In this post we saw how the Page Object Model can be modelled in a more functional way, using building blocks to construct pages. We also saw how we can transform interesting elements of the page into records that give us type safety and intellisense.</p>
<p>Lastly, we saw how concise the combination of F# and Canopy can make our UI tests.</p>
<h2 id="credits">Credits</h2>
<p>Social image by <a href="https://unsplash.com/@reinhartjulian">Reinhart Julian</a></p>
</article><hr><nav class="pager"><ul class="pager-links"><li><a href="/acceptance-tests/" title="Writing readable Acceptance tests">‚Üê Previous</a></li><li><a href="/anatomy-of-automated-testing/" title="Anatomy of an automated test suite">Next ‚Üí</a></li></ul></nav></main><footer class="site-footer"><p>Copyright &#169; <a href="/about/">Devon Burriss</a> 2026</p></footer><div class="comments"><div id="disqus_thread"></div><script type="text/javascript">var disqus_shortname = 'devonburriss';(function() { var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;dsq.src = 'https://devonburriss.disqus.com/embed.js';(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div><script src="/js/highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create', 'UA-45750611-2', 'auto');ga('send', 'pageview');</script></body></html>