<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Write your site description here. It will be used as your sites meta description as well!">

    <title>ASP.NET 5 Tips: TempData - Code Foo</title>

    <link rel="canonical" href="http://localhost:5001//asp-net-5-tips-tempdata/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="//">Code Foo</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="//">Home</a>
                </li>
                
				
                <li>
                    <a href="//about.html">About</a>
                </li>
				
                
				
                <li>
                    <a href="//atom.xml">this is a post</a>
                </li>
				
                
				
                <li>
                    <a href="//index.html">this is a post</a>
                </li>
				
                
				
                <li>
                    <a href="//rss.xml">this is a post</a>
                </li>
				
                
				
                <li>
                    <a href="//sitemap.xml">this is a post</a>
                </li>
				
                
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header" style="background-image: url('//img/home-bg.jpg')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>ASP.NET 5 Tips: TempData</h1>
                    
                    <span class="meta">Posted by Code Foo on January %-d, 2016</span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<blockquote>
<p>NOTE: Handling TempData and Session is made easy with extension methods in the <a href="https://www.nuget.org/packages/BetterSession.AspNet.Mvc/">BetterSession</a> Nuget package.</p>
</blockquote>
<p><img src="/img/posts/2016/footprint-resized.jpg" alt="bridge cables" /></p>
<blockquote>
<p>Just hold this</p>
</blockquote>
<p>ASPNET 5 is designed to be configurable. It starts out with almost nothing and you choose what you need. In previous versions of MVC we got TempData out the box. Not so with the new iteration.</p>
<!--more-->
<p>So to enable TempData for MVC you need sessions.
In <strong>project.json</strong> add the following lines to <em>dependencies</em></p>
<pre><code class="language-csharp">
"Microsoft.AspNet.Session": "1.0.0-*",
"Microsoft.Extensions.Caching.Memory": "1.0.0-*"
</code></pre>
<p>In <strong>Startup.cs</strong> the configuration of your services will need the following:</p>
<pre><code class="language-csharp">
public void ConfigureServices(IServiceCollection services)
{
  services.AddCaching();
  //this is the NB line for this post
  services.AddSession(o =>
  {
  	o.IdleTimeout = TimeSpan.FromSeconds(3600);
  });
  services.AddMvc();
}
</code></pre>
<p>While the app builder configuration will be something like so:</p>
<pre><code class="language-csharp">
public void Configure(IApplicationBuilder app, ILoggerFactory loggerFactory)
{
  loggerFactory.AddConsole(Configuration.GetSection("Logging"));
  loggerFactory.AddDebug();
  //this is the NB line for this post
  app.UseSession();
  app.UseIISPlatformHandler();
  app.UseStaticFiles();
  app.UseMvc();
}
</code></pre>
<p>Then accessing TempData is done through the dependency injection/service locator:</p>
<pre><code class="language-csharp">
public class TempController : Controller
{
  private const string key = "name";
  private readonly ITempDataDictionary _tempData;

  public TempController(ITempDataDictionary tempData)
  {
  	this._tempData = tempData;
  }

  public IActionResult Index()
  {
    _tempData[key] = "Devon";
    return RedirectToAction("Carry");
  }

  public IActionResult Carry()
  {
  	return View("Index", _tempData[key]);
  }
}
</code></pre>
<p>OR</p>
<pre><code class="language-csharp">
var tempData = HttpContext.RequestServices.GetRequiredService<ITempDataDictionary>();
</code></pre>
<blockquote>
<p>NOTE 1: When using ITempDataDictionary in a custom <strong>ActionResult</strong> I needed to mark the class with <strong>IKeepTempDataResult</strong> for it to work.</p>
</blockquote>
<blockquote>
<p>NOTE 2: I am not sure if this is going to change but currently the implementation for ITempDataDictionary only accepts primitive values (and string). I got around this by serializing to and from json. If you want to do this, you might find these extension methods useful.</p>
</blockquote>
<pre><code class="language-csharp">
public static void SetAsJson<T>(this ITempDataDictionary tempData, string key, T data)
{
  var sData = JsonConvert.SerializeObject(data);
  tempData[key] = sData;
}

public static T GetFromJson<T>(this ITempDataDictionary tempData, string key)
{
  if(tempData.ContainsKey(key))
  {
  	var v = tempData[key];

    if(v is T)
    {
    	return (T)v;
    }

    if(v is string && typeof(T) != typeof(string))
    {
      var obj = JsonConvert.DeserializeObject<T>((string)v);
      return obj;
    }
  }
  return default(T);
}
</code></pre>
<p>So hope you and future me finds this post useful. I am going to try blog little things like this as I work more with ASP.NET 5. Please let me know in the comments below if you did find it useful or if I missed anything. Also let me know if there are other topics you want me to cover.</p>

                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/aspnet-vsonline-ci/" data-toggle="tooltip" data-placement="top" title="ASP.NET 5 CI from Git to Azure without Visual Studio">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/asp-net-5-tips-urlhelper/" data-toggle="tooltip" data-placement="top" title="ASP.NET 5 Tips: UrlHelper">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>

    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="//feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    <li>
                        <a href="https://twitter.com/DevonBurriss">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a href="https://github.com/dburriss">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; Devon Burriss 2017</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>


    
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-45750611-2', 'auto');
  ga('send', 'pageview');

</script>



</body>

</html>
